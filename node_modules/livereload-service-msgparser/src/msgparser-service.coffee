soa = require('livereload-soa')
MessageParser = require './parser'

class MessageParserService extends soa.ServiceImpl
  initialize: ->

  on_parse: (command, callback) ->
    parser = new MessageParser(command.manifest)
    { messages, unparsed } = parser.parse(command.input)

    callback(null, { messages, unparsed })

  dispose: (callback) ->
    callback()

module.exports = (carrier, options={}) ->
  options.name or= 'msgparser'
  return new MessageParserService(carrier, options)
