{ok, deepEqual} = require 'assert'
sinon = require 'sinon'
createService = require '../lib/msgparser-service'
soa = require 'livereload-soa'


deepMatch = (expected) ->
  sinon.match (actual) ->
    JSON.stringify(expected) == JSON.stringify(actual)

describe "Message parser service", ->

  beforeEach -> @carrier = new soa.StubCarrier(); sinon.spy(@carrier, 'send')
  beforeEach -> @service = createService(@carrier)
  afterEach (done) -> @service?.dispose(done)

  it "sends 'hello' immediately after creation", ->
    sinon.assert.calledWith(@carrier.send, { command: 'hello', services: ['msgparser'] })
